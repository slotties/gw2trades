<script type="application/ld+json">
{
    "@context": "http://schema.org/",
    "@type": "Product",
    "name": "${latestStats.item.name}",
    "image": "${latestStats.item.iconUrl}",
    "offers": {
        "@type": "Offer",
        "priceCurrency": "Guild Wars 2 Coins",
        "price": "${latestStats.sellStatistics.minPrice}"
    }
}
</script>

<div class="page-header">
    <h1 class="rarity-${latestStats.item.rarity.toLowerCase()}">
        <img class="item-icon" alt="Item icon" src="${latestStats.item.iconUrl}"> ${latestStats.item.name} #if($latestStats.item.level > 0)<span title="#springMessage('details.item.levelReq')">(${latestStats.item.level})</span>#end
        <div class="link-outs">


        </div>
    </h1>
    <nav class="navbar navbar-default">
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
                <li><a href="#attributes">#springMessage('details.area.attributes')</a></li>
                <li><a href="#trading">#springMessage('details.area.trading')</a></li>
                <li><a href="#graphs">#springMessage('details.area.graphs')</a></li>

                <li><a href="http://wiki-en.guildwars2.com/wiki/${gw2.wikiName($latestStats.item.name)}">Wiki</a></li>
                <li><a href="https://gw2treasures.com/item/${latestStats.itemId}">gw2treaures</a></li>
            </ul>
        </div>
    </nav>
    <h3>
        <span class="text-profit">#springMessage('details.data.profit')</span> #price($gw2.profit($latestStats.buyStatistics.maxPrice, $latestStats.sellStatistics.minPrice))
    </h3>
</div>

<div class="row">
    <a name="attributes"></a>
    #if($latestStats.item.type == "Armor" || $latestStats.item.type == "Back" || $latestStats.item.type == "Trinket" || $latestStats.item.type == "UpgradeComponent" || $latestStats.item.type == "Weapon")
    <div class="col-md-4">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">#springMessage('details.attr.title')</h3>
            </div>
            <div class="panel-body">
                <ul class="item-attributes">
                #if($latestStats.item.type == "Weapon")
                <li>$springMacroRequestContext.getMessage("details.weaponStrength", [ $latestStats.item.details.minPower, $latestStats.item.details.maxPower ])</li>
                #end
                #foreach($attr in $latestStats.item.details.attributes.attributes)
                <li>
                    <span class="item-attributes-modifier">+&nbsp;${attr.modifier}</span>
                    <span class="item-attributes-name">#springMessage("details.attr.${attr.attribute}")</span>
                </li>
                #end
                #if(!$latestStats.item.details.attributes.attributes.empty)
                <li>&nbsp;</li>
                #end
                <li>#springMessage("details.rarity.${latestStats.item.rarity}")</li>
                #if($latestStats.item.type == "Armor")
                <li>#springMessage("details.weightClass.${latestStats.item.details.weightClass}")</li>
                #end
                <li>#springMessage("details.slot.${latestStats.item.details.type}")</li>
                </ul>
            </div>
        </div>
    </div>
    #end
</div>

<div class="row">
    <a name="trading"></a>
    <div class="col-md-6">
        <table class="table table-striped table-bordered table-hover">
            <tr>
                <th colspan="2" class="text-buyers">#springMessage('details.cols.buyers')</th>
            </tr>
            <tr>
                <th>#springMessage('details.cols.maxBuyer')</th>
                <td>#price(${latestStats.buyStatistics.maxPrice})</td>
            </tr>
            <tr>
                <th>#springMessage('details.cols.avgBuyer')</th>
                <td>#price($mathtool.floor($latestStats.buyStatistics.average))</td>
            </tr>
            <tr>
                <th>#springMessage('details.cols.minBuyer')</th>
                <td>#price($mathtool.floor($latestStats.buyStatistics.minPrice))</td>
            </tr>
            <tr>
                <th>#springMessage('details.cols.totalBuyers')</th>
                <td>${latestStats.buyStatistics.totalAmount}</td>
            </tr>
        </table>
    </div>
    <div class="col-md-6">
        <table class="table table-striped table-bordered table-hover">
            <tr>
                <th colspan="2" class="text-sellers">#springMessage('details.cols.sellers')</th>
            </tr>
            <tr>
                <th>#springMessage('details.cols.minSeller')</th>
                <td>#price(${latestStats.sellStatistics.minPrice})</td>
            </tr>
            <tr>
                <th>#springMessage('details.cols.avgSeller')</th>
                <td>#price($mathtool.floor($latestStats.sellStatistics.average))</td>
            </tr>
            <tr>
                <th>#springMessage('details.cols.maxSeller')</th>
                <td>#price($mathtool.floor($latestStats.sellStatistics.maxPrice))</td>
            </tr>
            <tr>
                <th>#springMessage('details.cols.totalSellers')</th>
                <td>${latestStats.sellStatistics.totalAmount}</td>
            </tr>
        </table>
    </div>
</div>

<div id="priceHistoryTooltip" class="gw2-history-tooltip" style="display: none;">
    <span class="tooltip-profit">#springMessage('details.tooltip.profit')</span>
    <span class="profit-value"></span>
    <br>
    <span class="tooltip-seller-avg">#springMessage('details.tooltip.avgSeller')</span>
    <span class="avg-seller-value"></span>
    <br>
    <span class="tooltip-seller">#springMessage('details.tooltip.minSeller')</span>
    <span class="lowest-seller-value"></span>
    <br>
    <span class="tooltip-bidder">#springMessage('details.tooltip.maxBuyer')</span>
    <span class="highest-bidder-value"></span>
    <br>
    <span class="tooltip-bidder-avg">#springMessage('details.tooltip.avgBuyer')</span>
    <span class="avg-bidder-value"></span>
</div>

<a name="graphs"></a>
<div class="btn-toolbar" role="toolbar">
    <div class="btn-group" role="group" id="chart-timeframe-selectors">
        <button type="button" class="btn btn-default" data-offset="1m">#springMessage('details.timeframes.1m')</button>
        <button type="button" class="btn btn-default" data-offset="7d" data-initial="true">#springMessage('details.timeframes.7d')</button>
        <button type="button" class="btn btn-default" data-offset="3d">#springMessage('details.timeframes.3d')</button>
        <button type="button" class="btn btn-default" data-offset="1d">#springMessage('details.timeframes.1d')</button>
    </div>
    <div class="btn-group" role="group" id="chart-line-selectors">
        <button type="button" class="btn btn-default text-data-profit" data-line="profit" data-initial="true">#springMessage('details.lines.profit')</button>
        <button type="button" class="btn btn-default text-data-avg-sellers" data-line="avg_sellers">#springMessage('details.lines.avgSellers')</button>
        <button type="button" class="btn btn-default text-data-min-sellers" data-line="min_sellers" data-initial="true">#springMessage('details.lines.minSellers')</button>
        <button type="button" class="btn btn-default text-data-max-buyers" data-line="max_buyers" data-initial="true">#springMessage('details.lines.maxBuyers')</button>
        <button type="button" class="btn btn-default text-data-avg-buyers" data-line="avg_buyers">#springMessage('details.lines.avgBuyers')</button>
    </div>
</div>
<div id="priceHistory"></div>
<div id="supplyDemand"></div>

<script src="//d3js.org/d3.v3.min.js"></script>
<script>
    window.gw2scope = {
        itemId: ${latestStats.item.itemId},
        labels: {
            min_sellers: "#springMessage('details.lines.minSellers')",
            avg_sellers: "#springMessage('details.lines.avgSellers')",
            max_buyers: "#springMessage('details.lines.maxBuyers')",
            avg_buyers: "#springMessage('details.lines.avgBuyers')",
            profit: "#springMessage('details.lines.profit')",
            sellers: "#springMessage('details.lines.sellers')",
            buyers: "#springMessage('details.lines.buyers')"
        }
    };
</script>
<script src="/static/js/history.js"></script>